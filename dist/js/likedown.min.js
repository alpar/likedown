/*
 * likedown - v1.0.0 - 2015-06-08
 * home: http://likedown.chiki.org/
 * Copyright (c) 2015 XiaoKu Inc. All Rights Reserved.
 */
+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("likedown"),f="object"==typeof b&&b;e||d.data("likedown",e=new c(this,f)),"string"==typeof b&&e[b]()})}var c=function(b,d){this.$element=a(b),this.options=a.extend({},c.DEFAULTS,d),this.options.postfix=this.options.postfix||this.$element.data("postfix")||"",this.init()};c.VERSION="0.0.1",c.DEFAULTS={table_class:"table table-bordered",highlighter:"highlight",help:function(){window.open("http://likedown.chiki.org/")}},c.prototype.init=function(){var a=this,b=this.converter=new Markdown.Converter,c=this.editor=new Markdown.Editor(b,this.options.postfix,{handler:this.options.help});Markdown.Extra.init(b,this.options),Markdown.MathJax.init(c,this.options.postfix),c.hooks.chain("onPreviewRefresh",this.onPreviewRefresh),c.hooks.chain("onPreviewRefresh",this.onAsyncPreview),c.hooks.set("insertLinkDialog",function(b){return a.insertLinkDialog(b)}),c.hooks.set("insertImageDialog",function(b){return a.insertImageDialog(b)}),c.run(),this.initModals()},c.prototype.initModals=function(){var b=this;a(".action-insert-link").click(function(){var c=a("#input-insert-link").val();void 0!==c&&(b.insertCallback(c),b.insertCallback=void 0)}),a(".action-insert-image").click(function(){var c=a("#input-insert-image").val();void 0!==c&&(b.insertCallback(c),b.insertCallback=void 0)}),a(".modal-insert-link, .modal-insert-image").on("hidden.bs.modal",function(){void 0!==b.insertCallback&&(b.insertCallback(null),b.insertCallback=void 0)})},c.prototype.resetModalInputs=function(){a("#input-insert-link, #input-insert-image").val("")},c.prototype.insertLinkDialog=function(b){return this.insertCallback=b,this.resetModalInputs(),a(".modal-insert-link").modal(),!0},c.prototype.insertImageDialog=function(b){return this.insertCallback=b,this.resetModalInputs(),a(".modal-insert-image").modal(),!0},c.prototype.onPreviewRefresh=function(){a("pre > code").each(function(){try{!this.highlighted&&hljs.highlightBlock(this),this.highlighted=!0}catch(a){}}),a("pre > code.language-sequence").each(function(){try{var a=Diagram.parse(this.textContent),b=this.parentNode,c=document.createElement("div");c.className="sequence-diagram",b.parentNode.replaceChild(c,b),a.drawSVG(c,{theme:"simple"})}catch(d){}}),a("pre > code.language-flow").each(function(){try{var a=flowchart.parse(this.textContent),b=this.parentNode,c=document.createElement("div");c.className="flow-chart",b.parentNode.replaceChild(c,b),a.drawSVG(c,{"line-width":2,"font-family":"sans-serif","font-weight":"normal"})}catch(d){}})};var d=[Markdown.MathJax.onAsyncPreview];c.prototype.onAsyncPreview=function(){function a(b){var c=b.length?b.shift():function(){};c(function(){a(b)})}a(d.concat([function(a){a()}]))};var e=a.fn.likedown;a.fn.likedown=b,a.fn.likedown.Constructor=c,a.fn.likedown.noConflict=function(){return a.fn.likedown=e,this},a(function(){a('[data-type="likedown"]').likedown()})}(jQuery);